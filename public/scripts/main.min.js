"use strict";function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,o){for(var t=0;t<o.length;t++){var a=o[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(o,t,a){return t&&e(o.prototype,t),a&&e(o,a),o}}(),Utils=function(){function e(){_classCallCheck(this,e),this.keysmap={escape:27}}return _createClass(e,[{key:"convertToTwoDigits",value:function(e){return e<10?"0"+e:e}},{key:"isCharacterKeyPress",value:function(e){return"undefined"==typeof e.which||"number"==typeof e.which&&e.which>0&&(!e.ctrlKey&&!e.metaKey&&!e.altKey&&8!=e.which)}},{key:"isTouchDevice",value:function(){return"undefined"!=typeof window.ontouchstart}},{key:"disableDefaultTouch",value:function(){$(document).on("touchmove",function(e){e.preventDefault()});var e=!1;$("body").on("touchstart",".scrollable",function(o){e||(e=!0,0===o.currentTarget.scrollTop?o.currentTarget.scrollTop=1:o.currentTarget.scrollHeight===o.currentTarget.scrollTop+o.currentTarget.offsetHeight&&(o.currentTarget.scrollTop-=1),e=!1)}),$("body").on("touchmove",".scrollable",function(e){e.stopPropagation()})}}]),e}(),ParallaxFactory=function(){function e(o){_classCallCheck(this,e),this.parallaxPackage={},this.maxDeg=o}return _createClass(e,[{key:"getMatrix",value:function(e,o){var t=this,a=e.clientWidth/2,i=e.clientHeight/2,n=a-(o.pageX-e.offsetLeft),s=i-(o.pageY-e.offsetTop);return t.parallaxPackage.degX=s/i*t.maxDeg+"deg",t.parallaxPackage.degY=n/a*-t.maxDeg+"deg",t.parallaxPackage.X=(o.pageX*-1/2+a/2)/8,t.parallaxPackage.Y=(o.pageY*-1/2+i/2)/8,t.parallaxPackage}}]),e}(),Countdown=function(){function e(o,t){_classCallCheck(this,e),this.endtime=o,this.$target=t,this.utils=new Utils,this.timeinterval=void 0}return _createClass(e,[{key:"getTimeRemaining",value:function(e){var o=Date.parse(e)-Date.parse(new Date),t=Math.floor(o/1e3%60),a=Math.floor(o/1e3/60%60),i=Math.floor(o/36e5%24),n=Math.floor(o/864e5);return{total:o,days:this.utils.convertToTwoDigits(n),hours:this.utils.convertToTwoDigits(i),minutes:this.utils.convertToTwoDigits(a),seconds:this.utils.convertToTwoDigits(t)}}},{key:"render",value:function(){var e=this.getTimeRemaining(this.endtime);this.$target.children(".days").html(e.days),this.$target.children(".hours").html(e.hours),this.$target.children(".mins").html(e.minutes),this.$target.children(".secs").html(e.seconds),e.total<=0&&(clearInterval(this.timeinterval),this.$target.hide())}},{key:"initCountdownClock",value:function(){this.render(),this.timeinterval=setInterval(function(){this.render()}.bind(this),1e3),setTimeout(function(){this.$target.removeClass("hidden")}.bind(this),500)}},{key:"destroy",value:function(){clearInterval(this.timeinterval),this.$target.addClass("hidden")}}]),e}();rko.carouselView=function(e){var o={swiper:void 0,swiperGallery:void 0,krizaTimeline:void 0,swiperLock:void 0,bindables:{},weddingCountdown:void 0,krizaPhotoTimeline:void 0,mattPhotoTimeline:void 0,currentSlideId:void 0};return o.init=function(o,t){console.log("view inited"),$("#main").html(o),$("#menu").html(t),$("body").removeClass().addClass("carouselMode"),$(document).on("keyup keypress",function(e){var o=e.keyCode||e.which;if(13===o)return e.preventDefault(),!1});var a,i=this;setTimeout(function(){$("#main").removeClass("loading")},100),$("#landing .km-logo").one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(e){console.log("e",e),"transitionend"===e.type&&($("#main").removeClass("entranceMode"),i.bind())}),$("#kriza .gallery-scroller").imagesLoaded(function(){a=-$("#kriza .gallery-scroller").innerHeight()+$(e).innerHeight(),i.krizaPhotoTimeline=new TimelineLite({paused:!0}),i.krizaPhotoTimeline.to($("#kriza .gallery-scroller"),300,{y:a+"px",force3D:!0,ease:Linear.easeNone})}),$("#matt .gallery-scroller").imagesLoaded(function(){a=-$("#matt .gallery-scroller").innerHeight()+$(e).innerHeight(),i.mattPhotoTimeline=new TimelineLite({paused:!0}),i.mattPhotoTimeline.to($("#matt .gallery-scroller"),300,{y:a+"px",force3D:!0,ease:Linear.easeNone})})},o.setupRSVPForm=function(){var e=$("#plusone-checkbox-result"),o=$("#plusone-input"),t=$("#rsvp-form"),a=$("#plusone-checkbox");a.on("click",function(t){$(t.target).is(":checked")?(e.val("Yes"),o.removeClass("hidden")):(e.val("No"),o.addClass("hidden"))}),t.submit(function(e){var o=$(this).attr("action");return console.log(""===$("#firstname").val()),""===$("#firstname").val()?(alert("Please enter your name"),!1):""===$("#email").val()?(alert("Please enter your email"),!1):($.ajax({type:"POST",url:o,data:$(this).serialize(),success:function(e){e=$.parseJSON(e),"success"===e.result?($("#rsvp-thankyou").addClass("show"),setTimeout(function(){$("#rsvp-thankyou").removeClass("show")},5e3),$("#rsvp-submit-btn").hide(),$("#rsvp-form input").prop("disabled",!0),$("#rsvp-form").addClass("disabled"),$(".rsvp-button-external").hide()):"rsvp_existed"===e.result&&alert("You have already RSVPed with the email: "+$("#email").val()+". Thank you and see you soon! \n - Kriza & Matt")}}),void e.preventDefault())})},o.unbindRSVPForm=function(){this.bindables.$plusOneCheckbox.off(),this.bindables.$rsvpForm.off()},o.handleCarouselSlideChangeStart=function(e){var t=$(".carousel-slide-active"),a=$(".swiper-pagination"),i=$("#menu-btn"),n=$("#menu");o.currentSlideId=t[0].id,t.hasClass("light-mode")?(i.addClass("light-mode"),n.addClass("light-mode")):(i.removeClass("light-mode"),n.removeClass("light-mode")),t.hasClass("light-mode")?a.addClass("light-mode"):a.removeClass("light-mode"),t.hasClass("no-pagination")?a.addClass("transparent-mode"):a.removeClass("transparent-mode"),"invitation"===o.currentSlideId?o.weddingCountdown.initCountdownClock():o.weddingCountdown.destroy(),e.disableMousewheelControl(),"kriza"===o.currentSlideId&&o.mattPhotoTimeline.stop(),"matt"===o.currentSlideId&&o.krizaPhotoTimeline.stop()},o.handleCarouselSlideChangeEnd=function(e){console.log("swiper",e.activeIndex),console.log("(swiper.slides.length -1)",e.slides.length-1),e.activeIndex==e.slides.length-1?$("#backToTop").addClass("show"):$("#backToTop").removeClass("show"),"gallery"===o.currentSlideId?o.swiperGallery.startAutoplay():o.swiperGallery.stopAutoplay(),o.swiperLock=setTimeout(function(){e.enableMousewheelControl()},600)},o.setupCarousel=function(){var e=this;console.log("created swiper!"),o.personalGallery=new Swiper(".swiper-container-personalGallery",{pagination:".swiper-pagination-gallery",direction:"horizontal",slidesPerView:1,effect:"fade",paginationClickable:!0,slideActiveClass:"gallery-slide-active",spaceBetween:0,speed:700,autoplay:1e4,autoplayDisableOnInteraction:!1,simulateTouch:!0,keyboardControl:!0,loop:!0,mousewheelForceToAxis:!0}),o.personalGallery.stopAutoplay(),o.personalGallery2=new Swiper(".swiper-container-personalGallery2",{pagination:".swiper-pagination-gallery",direction:"horizontal",slidesPerView:1,effect:"fade",paginationClickable:!0,slideActiveClass:"gallery-slide-active",spaceBetween:0,speed:700,autoplay:1e4,autoplayDisableOnInteraction:!1,simulateTouch:!0,keyboardControl:!0,loop:!0,mousewheelForceToAxis:!0}),o.personalGallery2.stopAutoplay(),o.swiperGallery=new Swiper(".swiper-container-gallery",{pagination:".swiper-pagination-gallery",direction:"horizontal",slidesPerView:1,effect:"fade",paginationClickable:!0,slideActiveClass:"gallery-slide-active",spaceBetween:0,speed:700,autoplay:3e3,autoplayDisableOnInteraction:!1,simulateTouch:!1,keyboardControl:!0,mousewheelControl:!0,mousewheelForceToAxis:!0,nextButton:".swiper-button-next",prevButton:".swiper-button-prev"}),o.swiperGallery.stopAutoplay(),o.swiper=new Swiper(".swiper-container",{pagination:".swiper-pagination",direction:"vertical",slidesPerView:1,slideActiveClass:"carousel-slide-active",paginationClickable:!0,spaceBetween:0,speed:700,mousewheelControl:!0,keyboardControl:!0,simulateTouch:!1,mousewheelForceToAxis:!0,mousewheelSensitivity:.5,onInit:function(e){setTimeout(function(){$(".swiper-pagination").addClass("active")},10)},onSlideChangeStart:function(o){e.handleCarouselSlideChangeStart(o)},onSlideChangeEnd:function(t){console.log("??????",o.swiperGallery),e.handleCarouselSlideChangeEnd(t)}})},o.setupParallaxEffects=function(){var e,o=new ParallaxFactory(5);$("#landing").mousemove(function(t){e=o.getMatrix(this,t),$("#parallax-landing").css("transform","translate3d("+e.X/2+"px, "+e.Y/2+"px, -200px)"),$("#landing .km-logo").css("transform","perspective(200px) translate3d("+-e.X/12+"px, "+-e.Y/12+"px, 0)")}),$("#quote").mousemove(function(t){e=o.getMatrix(this,t),$("#quote-landing").css("transform","perspective(600px) translate3d("+e.X/2+"px, "+e.Y/2+"px, -10px)")}),$("#location").mousemove(function(t){e=o.getMatrix(this,t),$("#location-landing").css("transform","perspective(600px) translate3d("+e.X/2+"px, "+e.Y/2+"px, -10px)")}),$("#seeyou").mousemove(function(t){e=o.getMatrix(this,t),$("#seeyou-landing").css("transform","perspective(600px) translate3d("+e.X/5+"px, "+e.Y/5+"px, -10px)")})},o.bind=function(){console.log("bind called!");this.setupRSVPForm(),this.setupCarousel(),this.setupParallaxEffects(),this.weddingCountdown=new Countdown("2017-06-23",$("#invitation .countdown")),$("#backToTop").on("click",function(){o.swiper.slideTo(0,2e3)}),$("#menu-btn, #slider-menu-btn").on("click",function(){console.log("hit"),$("body").hasClass("menuMode")?$("body").removeClass("menuMode"):$("body").addClass("menuMode")}),$(".rsvp-button-external").on("click",function(){$("body").hasClass("menuMode")||$("#menu-btn").trigger("click"),$("#firstname").focus()}),$("#matt .gallery-movingUp-area").hover(function(){o.mattPhotoTimeline.reverse(),o.mattPhotoTimeline.timeScale(25)},function(){o.mattPhotoTimeline.stop(),o.mattPhotoTimeline.timeScale(1)}),$("#kriza .gallery-movingUp-area").hover(function(){o.krizaPhotoTimeline.reverse(),o.krizaPhotoTimeline.timeScale(25)},function(){o.krizaPhotoTimeline.stop(),o.krizaPhotoTimeline.timeScale(1)}),$("#matt .gallery-movingDown-area").hover(function(){o.mattPhotoTimeline.play(),o.mattPhotoTimeline.timeScale(25)},function(){o.mattPhotoTimeline.stop(),o.mattPhotoTimeline.timeScale(1)}),$("#kriza .gallery-movingDown-area").hover(function(){o.krizaPhotoTimeline.play(),o.krizaPhotoTimeline.timeScale(25)},function(){o.krizaPhotoTimeline.stop(),o.krizaPhotoTimeline.timeScale(1)})},o}(window),rko.passwordView=function(e){var o={previousModeLabel:void 0,modeLabel:"passwordMode",bindables:{$passwordInput:$("#password-input"),$passwordForm:$("#password-form"),$doc:$(document)},$body:$("body"),$passwordErrorMsg:$("#login-error-msg"),helloMessages:["Hello!","안녕하세요!"],submitInProgress:!1},t=new Utils,a=rko.carouselView;return o.bind=function(){var e,i=this;i.bindables.$passwordInput.keydown(function(e){i.hidePasswordErrorMessage()}),i.bindables.$doc.keydown(function(o){e=o.keyCode,i.$body.hasClass(i.previousModeLabel)&&t.isCharacterKeyPress(o)&&e!==t.keysmap.escape&&(i.$body.removeClass().addClass(i.modeLabel),i.bindables.$passwordInput.focus()),i.$body.hasClass(i.modeLabel)&&e===t.keysmap.escape&&(i.$body.removeClass().addClass(i.previousModeLabel),i.bindables.$passwordInput.val(""))}),t.isTouchDevice()&&i.bindables.$doc.on("click",function(){i.$body.hasClass(i.previousModeLabel)&&(i.$body.removeClass().addClass(i.modeLabel),i.bindables.$passwordInput.focus())}),i.bindables.$passwordForm.submit(function(e){var t=$(this).attr("action");o.submitInProgress?console.log("pw form in progress, locked!"):(console.log("pw form submitted"),o.submitInProgress=!0,$.ajax({type:"POST",url:t,data:$(this).serialize(),success:function(e){e=$.parseJSON(e),"success"===e.result?($(".password-hint").html(o.helloMessages[Math.floor(Math.random()*o.helloMessages.length)]),$(".unlock-icon").removeClass("hidden"),$(".lock-icon").addClass("hidden"),a.init(e.html,e.menuHtml),document.activeElement.blur()):(i.showPasswordErrorMessage(),o.submitInProgress=!1)}})),e.preventDefault()})},o.unbind=function(){var e=this.bindables;for(var o in e)e.hasOwnProperty(o)&&e[o].off()},o.showPasswordErrorMessage=function(){this.$passwordErrorMsg.addClass("show")},o.hidePasswordErrorMessage=function(){this.$passwordErrorMsg.removeClass("show")},o.init=function(e){this.previousModeLabel=e,this.bind()},o}(window),rko.app=function(e){var o={previousMode:void 0,modeLabel:"introMode",$lockIcon:$(".lock-icon"),$logo:$(".logo"),$background:$("#parallax-auth"),$viewContainer:$("#lock")},t=rko.passwordView,a=new Utils;return o.init=function(){a.disableDefaultTouch(),setTimeout(function(){console.log("loaded!"),o.$viewContainer.removeClass("loading")},100);var e=this;$(".logo").one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(o){e.$viewContainer.removeClass("entranceMode"),console.log(o),"transitionend"===o.type&&(e.setupParallaxEffects(),t.init(e.modeLabel))})},o.setupParallaxEffects=function(){var e,o=new ParallaxFactory(5),t=this;this.$viewContainer.mousemove(function(a){e=o.getMatrix(this,a),t.$lockIcon.css("transform","perspective(40px) translate3d("+-e.X/4+"px, "+-e.Y/4+"px, 0) rotateX("+e.degX+") rotateY("+e.degY+")"),t.$logo.css("transform","perspective(500px) translate3d("+-e.X/8+"px, "+-e.Y/8+"px, 0) rotateX("+e.degX+") rotateY("+e.degY+")"),t.$background.css("transform","perspective(1000px) translate3d("+e.X/2+"px, "+e.Y/2+"px, -20px)")})},o}(window);